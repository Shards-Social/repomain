{"ast":null,"code":"// https://stackoverflow.com/questions/20600800/js-client-side-exif-orientation-rotate-and-mirror-jpeg-images/31273162#31273162\n\nconst orientation = file => {\n  return new Promise(resolve => {\n    const reader = new window.FileReader();\n    reader.onload = function (event) {\n      var view = new DataView(event.target.result);\n      if (view.getUint16(0, false) !== 0xffd8) {\n        resolve(-2);\n      }\n      const length = view.byteLength;\n      let offset = 2;\n      while (offset < length) {\n        const marker = view.getUint16(offset, false);\n        offset += 2;\n        if (marker === 0xffe1) {\n          if (view.getUint32(offset += 2, false) !== 0x45786966) {\n            resolve(-1);\n          }\n          const little = view.getUint16(offset += 6, false) === 0x4949;\n          offset += view.getUint32(offset + 4, little);\n          const tags = view.getUint16(offset, little);\n          offset += 2;\n          for (let i = 0; i < tags; i++) {\n            if (view.getUint16(offset + i * 12, little) === 0x0112) {\n              resolve(view.getUint16(offset + i * 12 + 8, little));\n            }\n          }\n        } else if ((marker & 0xff00) !== 0xff00) break;else offset += view.getUint16(offset, false);\n      }\n      resolve(-1);\n    };\n    reader.readAsArrayBuffer(file.slice(0, 64 * 1024));\n  });\n};\nexport default {\n  orientation\n};","map":{"version":3,"names":["orientation","file","Promise","resolve","reader","window","FileReader","onload","event","view","DataView","target","result","getUint16","length","byteLength","offset","marker","getUint32","little","tags","i","readAsArrayBuffer","slice"],"sources":["C:/Users/samth/repomain-1/node_modules/compress.js/src/core/rotate.js"],"sourcesContent":["// https://stackoverflow.com/questions/20600800/js-client-side-exif-orientation-rotate-and-mirror-jpeg-images/31273162#31273162\n\nconst orientation = (file) => {\n  return new Promise((resolve) => {\n    const reader = new window.FileReader();\n\n    reader.onload = function (event) {\n      var view = new DataView(event.target.result);\n\n      if (view.getUint16(0, false) !== 0xffd8) {\n        resolve(-2);\n      }\n      const length = view.byteLength;\n      let offset = 2;\n\n      while (offset < length) {\n        const marker = view.getUint16(offset, false);\n        offset += 2;\n\n        if (marker === 0xffe1) {\n          if (view.getUint32((offset += 2), false) !== 0x45786966) {\n            resolve(-1);\n          }\n          const little = view.getUint16((offset += 6), false) === 0x4949;\n          offset += view.getUint32(offset + 4, little);\n          const tags = view.getUint16(offset, little);\n          offset += 2;\n\n          for (let i = 0; i < tags; i++) {\n            if (view.getUint16(offset + i * 12, little) === 0x0112) {\n              resolve(view.getUint16(offset + i * 12 + 8, little));\n            }\n          }\n        } else if ((marker & 0xff00) !== 0xff00) break;\n        else offset += view.getUint16(offset, false);\n      }\n      resolve(-1);\n    };\n    reader.readAsArrayBuffer(file.slice(0, 64 * 1024));\n  });\n};\n\nexport default { orientation };\n"],"mappings":"AAAA;;AAEA,MAAMA,WAAW,GAAIC,IAAI,IAAK;EAC5B,OAAO,IAAIC,OAAO,CAAEC,OAAO,IAAK;IAC9B,MAAMC,MAAM,GAAG,IAAIC,MAAM,CAACC,UAAU,EAAE;IAEtCF,MAAM,CAACG,MAAM,GAAG,UAAUC,KAAK,EAAE;MAC/B,IAAIC,IAAI,GAAG,IAAIC,QAAQ,CAACF,KAAK,CAACG,MAAM,CAACC,MAAM,CAAC;MAE5C,IAAIH,IAAI,CAACI,SAAS,CAAC,CAAC,EAAE,KAAK,CAAC,KAAK,MAAM,EAAE;QACvCV,OAAO,CAAC,CAAC,CAAC,CAAC;MACb;MACA,MAAMW,MAAM,GAAGL,IAAI,CAACM,UAAU;MAC9B,IAAIC,MAAM,GAAG,CAAC;MAEd,OAAOA,MAAM,GAAGF,MAAM,EAAE;QACtB,MAAMG,MAAM,GAAGR,IAAI,CAACI,SAAS,CAACG,MAAM,EAAE,KAAK,CAAC;QAC5CA,MAAM,IAAI,CAAC;QAEX,IAAIC,MAAM,KAAK,MAAM,EAAE;UACrB,IAAIR,IAAI,CAACS,SAAS,CAAEF,MAAM,IAAI,CAAC,EAAG,KAAK,CAAC,KAAK,UAAU,EAAE;YACvDb,OAAO,CAAC,CAAC,CAAC,CAAC;UACb;UACA,MAAMgB,MAAM,GAAGV,IAAI,CAACI,SAAS,CAAEG,MAAM,IAAI,CAAC,EAAG,KAAK,CAAC,KAAK,MAAM;UAC9DA,MAAM,IAAIP,IAAI,CAACS,SAAS,CAACF,MAAM,GAAG,CAAC,EAAEG,MAAM,CAAC;UAC5C,MAAMC,IAAI,GAAGX,IAAI,CAACI,SAAS,CAACG,MAAM,EAAEG,MAAM,CAAC;UAC3CH,MAAM,IAAI,CAAC;UAEX,KAAK,IAAIK,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGD,IAAI,EAAEC,CAAC,EAAE,EAAE;YAC7B,IAAIZ,IAAI,CAACI,SAAS,CAACG,MAAM,GAAGK,CAAC,GAAG,EAAE,EAAEF,MAAM,CAAC,KAAK,MAAM,EAAE;cACtDhB,OAAO,CAACM,IAAI,CAACI,SAAS,CAACG,MAAM,GAAGK,CAAC,GAAG,EAAE,GAAG,CAAC,EAAEF,MAAM,CAAC,CAAC;YACtD;UACF;QACF,CAAC,MAAM,IAAI,CAACF,MAAM,GAAG,MAAM,MAAM,MAAM,EAAE,MAAM,KAC1CD,MAAM,IAAIP,IAAI,CAACI,SAAS,CAACG,MAAM,EAAE,KAAK,CAAC;MAC9C;MACAb,OAAO,CAAC,CAAC,CAAC,CAAC;IACb,CAAC;IACDC,MAAM,CAACkB,iBAAiB,CAACrB,IAAI,CAACsB,KAAK,CAAC,CAAC,EAAE,EAAE,GAAG,IAAI,CAAC,CAAC;EACpD,CAAC,CAAC;AACJ,CAAC;AAED,eAAe;EAAEvB;AAAY,CAAC"},"metadata":{},"sourceType":"module"}