{"ast":null,"code":"import React,{useEffect,useState}from\"react\";import{sendIcon,fileIcon}from\"../../assets\";import{useDispatch}from\"react-redux\";import{addPost,updatePost}from\"../../features/postSlice\";import useFetch from\"../../hooks/useFetch\";import Compress from\"compress.js\";import{closeIcon}from\"../../assets/index\";import\"./createpost.css\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";const initialForm={image:null,preview:null,caption:\"\"};const CreatePost=_ref=>{let{post,id,close}=_ref;// local states\nconst[form,setForm]=useState(initialForm);useEffect(()=>{if(post&&post._id){var _post$image;setForm({image:null,preview:(_post$image=post.image)===null||_post$image===void 0?void 0:_post$image.src,caption:post.caption});}},[post]);const dispatch=useDispatch();const customFetch=useFetch();const compress=new Compress();const compressImage=async files=>{const options={size:1,quality:0.75,maxWidth:1920,maxHeight:1920,resize:true,rotate:false};const data=await compress.compress(files,options);return data;};const loadImage=async e=>{var _data$,_data$2;const input=e.target;if(!input)return;var reader=new FileReader();reader.onload=function(e){setForm(form=>({...form,preview:e.target.result}));};input.files[0]&&reader.readAsDataURL(input.files[0]);const files=[...input.files];const data=await compressImage(files);const image=Compress.convertBase64ToFile((_data$=data[0])===null||_data$===void 0?void 0:_data$.data,(_data$2=data[0])===null||_data$2===void 0?void 0:_data$2.ext);setForm(form=>({...form,image}));};const submitHandler=async e=>{e.preventDefault();const formData=new FormData();formData.append(\"image\",form.image);formData.append(\"caption\",form.caption.trim());if(post!==null&&post!==void 0&&post._id){dispatch(updatePost({customFetch,id:post._id,formData}));close();}else{dispatch(addPost({customFetch,formData}));}setForm(initialForm);};return/*#__PURE__*/_jsx(\"article\",{className:\"createpost gradient-border\",children:/*#__PURE__*/_jsxs(\"form\",{onSubmit:submitHandler,children:[/*#__PURE__*/_jsx(\"textarea\",{placeholder:\"What's on your mind?\",value:form.caption,onChange:e=>setForm({...form,caption:e.target.value})}),form.preview&&/*#__PURE__*/_jsxs(\"div\",{className:\"uploaded-image\",children:[/*#__PURE__*/_jsx(\"img\",{src:form.preview,alt:\"uploaded file\"}),/*#__PURE__*/_jsx(\"div\",{className:\"close-icon\",onClick:()=>setForm({...form,image:null,preview:null}),children:/*#__PURE__*/_jsx(\"img\",{src:closeIcon,alt:\"remove\"})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"btns\",children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:id||\"image\",\"aria-label\":\"select file\",children:/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(\"img\",{src:fileIcon,alt:\"select file\"})})}),/*#__PURE__*/_jsx(\"input\",{type:\"file\",id:id||\"image\",accept:\"image/png, image/jpeg\",onChange:loadImage}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",\"aria-label\":\"submit\",children:/*#__PURE__*/_jsx(\"img\",{src:sendIcon,alt:\"send\"})})]})]})});};export default CreatePost;","map":{"version":3,"names":["React","useEffect","useState","sendIcon","fileIcon","useDispatch","addPost","updatePost","useFetch","Compress","closeIcon","jsx","_jsx","jsxs","_jsxs","initialForm","image","preview","caption","CreatePost","_ref","post","id","close","form","setForm","_id","_post$image","src","dispatch","customFetch","compress","compressImage","files","options","size","quality","maxWidth","maxHeight","resize","rotate","data","loadImage","e","_data$","_data$2","input","target","reader","FileReader","onload","result","readAsDataURL","convertBase64ToFile","ext","submitHandler","preventDefault","formData","FormData","append","trim","className","children","onSubmit","placeholder","value","onChange","alt","onClick","htmlFor","type","accept"],"sources":["C:/Users/samth/repomain-1/src/components/CreatePost/CreatePost.jsx"],"sourcesContent":["import React, { useEffect, useState } from \"react\";\r\nimport { sendIcon, fileIcon } from \"../../assets\";\r\nimport { useDispatch } from \"react-redux\";\r\nimport { addPost, updatePost } from \"../../features/postSlice\";\r\nimport useFetch from \"../../hooks/useFetch\";\r\nimport Compress from \"compress.js\";\r\nimport { closeIcon } from \"../../assets/index\";\r\nimport \"./createpost.css\";\r\n\r\nconst initialForm = { image: null, preview: null, caption: \"\" };\r\n\r\nconst CreatePost = ({ post, id, close }) => {\r\n\t// local states\r\n\tconst [form, setForm] = useState(initialForm);\r\n\r\n\tuseEffect(() => {\r\n\t\tif (post && post._id) {\r\n\t\t\tsetForm({ image: null, preview: post.image?.src, caption: post.caption });\r\n\t\t}\r\n\t}, [post]);\r\n\r\n\tconst dispatch = useDispatch();\r\n\tconst customFetch = useFetch();\r\n\tconst compress = new Compress();\r\n\r\n\tconst compressImage = async files => {\r\n\t\tconst options = { size: 1, quality: 0.75, maxWidth: 1920, maxHeight: 1920, resize: true, rotate: false };\r\n\t\tconst data = await compress.compress(files, options);\r\n\t\treturn data;\r\n\t};\r\n\r\n\tconst loadImage = async e => {\r\n\t\tconst input = e.target;\r\n\t\tif (!input) return;\r\n\t\tvar reader = new FileReader();\r\n\t\treader.onload = function (e) {\r\n\t\t\tsetForm(form => ({ ...form, preview: e.target.result }));\r\n\t\t};\r\n\t\tinput.files[0] && reader.readAsDataURL(input.files[0]);\r\n\t\tconst files = [...input.files];\r\n\t\tconst data = await compressImage(files);\r\n\t\tconst image = Compress.convertBase64ToFile(data[0]?.data, data[0]?.ext);\r\n\t\tsetForm(form => ({ ...form, image }));\r\n\t};\r\n\r\n\tconst submitHandler = async e => {\r\n\t\te.preventDefault();\r\n\t\tconst formData = new FormData();\r\n\t\tformData.append(\"image\", form.image);\r\n\t\tformData.append(\"caption\", form.caption.trim());\r\n\t\tif (post?._id) {\r\n\t\t\tdispatch(updatePost({ customFetch, id: post._id, formData }));\r\n\t\t\tclose();\r\n\t\t} else {\r\n\t\t\tdispatch(addPost({ customFetch, formData }));\r\n\t\t}\r\n\t\tsetForm(initialForm);\r\n\t};\r\n\r\n\treturn (\r\n\t\t<article className=\"createpost gradient-border\">\r\n\t\t\t<form onSubmit={submitHandler}>\r\n\t\t\t\t<textarea\r\n\t\t\t\t\tplaceholder=\"What's on your mind?\"\r\n\t\t\t\t\tvalue={form.caption}\r\n\t\t\t\t\tonChange={e => setForm({ ...form, caption: e.target.value })}\r\n\t\t\t\t/>\r\n\t\t\t\t{form.preview && (\r\n\t\t\t\t\t<div className=\"uploaded-image\">\r\n\t\t\t\t\t\t<img src={form.preview} alt=\"uploaded file\" />\r\n\t\t\t\t\t\t<div className=\"close-icon\" onClick={() => setForm({ ...form, image: null, preview: null })}>\r\n\t\t\t\t\t\t\t<img src={closeIcon} alt=\"remove\" />\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t)}\r\n\t\t\t\t<div className=\"btns\">\r\n\t\t\t\t\t<label htmlFor={id || \"image\"} aria-label=\"select file\">\r\n\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t<img src={fileIcon} alt=\"select file\" />\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</label>\r\n\t\t\t\t\t<input type=\"file\" id={id || \"image\"} accept=\"image/png, image/jpeg\" onChange={loadImage} />\r\n\t\t\t\t\t<button type=\"submit\" aria-label=\"submit\">\r\n\t\t\t\t\t\t<img src={sendIcon} alt=\"send\" />\r\n\t\t\t\t\t</button>\r\n\t\t\t\t</div>\r\n\t\t\t</form>\r\n\t\t</article>\r\n\t);\r\n};\r\n\r\nexport default CreatePost;\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}