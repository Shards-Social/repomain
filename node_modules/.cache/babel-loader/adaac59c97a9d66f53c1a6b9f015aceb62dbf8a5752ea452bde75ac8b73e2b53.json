{"ast":null,"code":"import React,{useEffect,useState}from\"react\";//utilities\nimport{io}from\"socket.io-client\";import Cookies from\"js-cookie\";import useFetch from\"./hooks/useFetch.js\";import SERVER_URI from\"./serverUri\";//redux\nimport{useDispatch,useSelector}from\"react-redux\";import{login}from\"./features/userSlice.js\";import{setSocket}from\"./features/socketSlice\";import{showModal}from\"./features/modalSlice.js\";import{addMessages,clearMessage,deleteChat,updateChats}from\"./features/messageSlice.js\";import{addOnline,getUsers}from\"./features/usersSlice.js\";import{setPosts}from\"./features/postSlice.js\";//components\nimport Auth from\"./pages/Auth/Auth\";import Modal from\"./components/Modal/Modal.jsx\";import Loading from\"./components/Loading/Loading.jsx\";import Backdrop from\"./components/Backdrop/Backdrop.jsx\";import ThemeSwitch from\"./components/ThemeSwitch/ThemeSwitch.jsx\";import Router from\"./routes\";import Online from\"./components/Online/Online.jsx\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function App(){const dispatch=useDispatch();const customFetch=useFetch();const[theme,setTheme]=useState(\"dark\");const{user:{id,isGuest},modal:{isLoading,isSidebarVisible},socket:{socket},message:{to,conversationID}}=useSelector(state=>state);//login\nuseEffect(()=>{const user=Cookies.get(\"user\");if(user)dispatch(login(JSON.parse(user)));else dispatch(login({id:\"guest\",isGuest:true}));},[dispatch]);//get users and chats and init socket\nuseEffect(()=>{if(id){const query=\"id=\".concat(id);dispatch(getUsers({customFetch}));dispatch(setPosts({customFetch}));if(!isGuest)dispatch(setSocket(io(SERVER_URI,{query})));}},[id,customFetch,dispatch,isGuest]);//socket events\nuseEffect(()=>{if(socket){socket.on(\"usersOnline\",users=>dispatch(addOnline(users)));socket.on(\"delete chat\",id=>dispatch(deleteChat(id)));}},[socket,dispatch]);useEffect(()=>{if(socket){socket.off(\"receive message\").on(\"receive message\",(message,senderID)=>{dispatch(showModal({msg:\"1 new message\"}));dispatch(updateChats({lastMessage:message,id:senderID,customFetch}));senderID===to&&dispatch(addMessages({text:message}));});socket.off(\"clear chat\").on(\"clear chat\",id=>dispatch(clearMessage({conversationID:id})));}},[customFetch,dispatch,socket,to,conversationID]);return/*#__PURE__*/_jsxs(\"div\",{className:\"app \"+theme,children:[/*#__PURE__*/_jsxs(\"div\",{className:\"container\",children:[/*#__PURE__*/_jsxs(\"div\",{className:isSidebarVisible?\"sidebar visible\":\"sidebar\",children:[/*#__PURE__*/_jsx(ThemeSwitch,{setTheme:setTheme}),/*#__PURE__*/_jsx(Online,{})]}),/*#__PURE__*/_jsx(ThemeSwitch,{setTheme:setTheme}),/*#__PURE__*/_jsx(Modal,{}),id?/*#__PURE__*/_jsx(Router,{}):/*#__PURE__*/_jsx(Auth,{})]}),/*#__PURE__*/_jsx(Backdrop,{show:isLoading,children:/*#__PURE__*/_jsx(Loading,{})})]});}export default App;","map":{"version":3,"names":["React","useEffect","useState","io","Cookies","useFetch","SERVER_URI","useDispatch","useSelector","login","setSocket","showModal","addMessages","clearMessage","deleteChat","updateChats","addOnline","getUsers","setPosts","Auth","Modal","Loading","Backdrop","ThemeSwitch","Router","Online","jsx","_jsx","jsxs","_jsxs","App","dispatch","customFetch","theme","setTheme","user","id","isGuest","modal","isLoading","isSidebarVisible","socket","message","to","conversationID","state","get","JSON","parse","query","concat","on","users","off","senderID","msg","lastMessage","text","className","children","show"],"sources":["C:/Users/samth/repomain-1/src/App.js"],"sourcesContent":["import React, { useEffect, useState } from \"react\";\r\n//utilities\r\nimport { io } from \"socket.io-client\";\r\nimport Cookies from \"js-cookie\";\r\nimport useFetch from \"./hooks/useFetch.js\";\r\nimport SERVER_URI from \"./serverUri\";\r\n//redux\r\nimport { useDispatch, useSelector } from \"react-redux\";\r\nimport { login } from \"./features/userSlice.js\";\r\nimport { setSocket } from \"./features/socketSlice\";\r\nimport { showModal } from \"./features/modalSlice.js\";\r\nimport { addMessages, clearMessage, deleteChat, updateChats } from \"./features/messageSlice.js\";\r\nimport { addOnline, getUsers } from \"./features/usersSlice.js\";\r\nimport { setPosts } from \"./features/postSlice.js\";\r\n//components\r\nimport Auth from \"./pages/Auth/Auth\";\r\nimport Modal from \"./components/Modal/Modal.jsx\";\r\nimport Loading from \"./components/Loading/Loading.jsx\";\r\nimport Backdrop from \"./components/Backdrop/Backdrop.jsx\";\r\nimport ThemeSwitch from \"./components/ThemeSwitch/ThemeSwitch.jsx\";\r\nimport Router from \"./routes\";\r\nimport Online from \"./components/Online/Online.jsx\";\r\n\r\nfunction App() {\r\n\tconst dispatch = useDispatch();\r\n\tconst customFetch = useFetch();\r\n\tconst [theme, setTheme] = useState(\"dark\");\r\n\tconst {\r\n\t\tuser: { id, isGuest },\r\n\t\tmodal: { isLoading, isSidebarVisible },\r\n\t\tsocket: { socket },\r\n\t\tmessage: { to, conversationID },\r\n\t} = useSelector(state => state);\r\n\r\n\t//login\r\n\tuseEffect(() => {\r\n\t\tconst user = Cookies.get(\"user\");\r\n\t\tif (user) dispatch(login(JSON.parse(user)));\r\n\t\telse dispatch(login({ id: \"guest\", isGuest: true }));\r\n\t}, [dispatch]);\r\n\r\n\t//get users and chats and init socket\r\n\tuseEffect(() => {\r\n\t\tif (id) {\r\n\t\t\tconst query = `id=${id}`;\r\n\t\t\tdispatch(getUsers({ customFetch }));\r\n\t\t\tdispatch(setPosts({ customFetch }));\r\n\t\t\tif (!isGuest) dispatch(setSocket(io(SERVER_URI, { query })));\r\n\t\t}\r\n\t}, [id, customFetch, dispatch, isGuest]);\r\n\r\n\t//socket events\r\n\tuseEffect(() => {\r\n\t\tif (socket) {\r\n\t\t\tsocket.on(\"usersOnline\", users => dispatch(addOnline(users)));\r\n\t\t\tsocket.on(\"delete chat\", id => dispatch(deleteChat(id)));\r\n\t\t}\r\n\t}, [socket, dispatch]);\r\n\r\n\tuseEffect(() => {\r\n\t\tif (socket) {\r\n\t\t\tsocket.off(\"receive message\").on(\"receive message\", (message, senderID) => {\r\n\t\t\t\tdispatch(showModal({ msg: \"1 new message\" }));\r\n\t\t\t\tdispatch(updateChats({ lastMessage: message, id: senderID, customFetch }));\r\n\t\t\t\tsenderID === to && dispatch(addMessages({ text: message }));\r\n\t\t\t});\r\n\t\t\tsocket.off(\"clear chat\").on(\"clear chat\", id => dispatch(clearMessage({ conversationID: id })));\r\n\t\t}\r\n\t}, [customFetch, dispatch, socket, to, conversationID]);\r\n\r\n\treturn (\r\n\t\t<div className={\"app \" + theme}>\r\n\t\t\t<div className=\"container\">\r\n\t\t\t\t<div className={isSidebarVisible ? \"sidebar visible\" : \"sidebar\"}>\r\n\t\t\t\t\t<ThemeSwitch setTheme={setTheme} />\r\n\t\t\t\t\t<Online />\r\n\t\t\t\t</div>\r\n\t\t\t\t<ThemeSwitch setTheme={setTheme} />\r\n\t\t\t\t<Modal />\r\n\t\t\t\t{id ? <Router /> : <Auth />}\r\n\t\t\t</div>\r\n\t\t\t<Backdrop show={isLoading}>\r\n\t\t\t\t<Loading />\r\n\t\t\t</Backdrop>\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\nexport default App;\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}