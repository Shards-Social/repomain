{"ast":null,"code":"import{createAsyncThunk,createSlice}from\"@reduxjs/toolkit\";import{createChatService,fetchChatsService,fetchMessagesService}from\"../services/messageServices\";import{logout}from\"./userSlice\";const initialState={conversationID:\"\",to:\"\",messages:[],chats:[]};export const getAllChats=createAsyncThunk(\"message/getAllChats\",async(props,thunkAPI)=>{const{customFetch,users}=props;const{getState,rejectWithValue,fulfillWithValue}=thunkAPI;const{user}=getState();const data=await customFetch(fetchChatsService);if(!data)return rejectWithValue();return fulfillWithValue({users:users.filter(u=>u._id!==user.id),chats:data.chats});});export const createChat=createAsyncThunk(\"message/createChat\",async(props,thunkAPI)=>{const{getState,dispatch,rejectWithValue}=thunkAPI;const{customFetch,id}=props;const{user,users,message}=getState();const data=await customFetch(createChatService,{partnerId:id});if(!data)rejectWithValue();if(message.chats.every(chat=>chat._id!==data.cid)){dispatch(getAllChats({customFetch,users:users.users}));}dispatch(messageSlice.actions.setChatID(data.cid));dispatch(messageSlice.actions.setReceiverID(id));const _data=await customFetch(fetchMessagesService,{chatId:data.cid});dispatch(clearMessage());dispatch(setMessages({messages:_data.messages,id:user.id}));});export const updateChats=createAsyncThunk(\"message/updateChat\",async(props,thunkAPI)=>{const{getState,dispatch,fulfillWithValue}=thunkAPI;const{lastMessage,id,chatId,customFetch}=props;const{message,users}=getState();let index;if(chatId)index=message.chats.findIndex(chat=>chat._id===chatId);else index=message.chats.findIndex(chat=>chat.members.includes(id));if(index>=0)return fulfillWithValue({index,lastMessage});dispatch(getAllChats({customFetch,users:users.users}));});const messageSlice=createSlice({name:\"message\",initialState,reducers:{clearMessage:(state,action)=>{var _action$payload;const conversationID=(_action$payload=action.payload)===null||_action$payload===void 0?void 0:_action$payload.conversationID;if(conversationID){const index=state.chats.findIndex(chat=>chat._id===conversationID);const updatingChat=state.chats[index];state.chats=[{...updatingChat,lastMessage:\"\"},...state.chats.filter(chat=>chat._id!==conversationID)];if(conversationID===state.conversationID)state.messages=[];}else{state.messages=[];}},setChatID:(state,action)=>{state.conversationID=action.payload;},setReceiverID:(state,action)=>{state.to=action.payload;},setMessages:(state,action)=>{const{messages,id}=action.payload;state.messages=messages.map(message=>{return{text:message.text,send:message.sender===id,createdAt:message.createdAt};});},addMessages:(state,action)=>{const{text,send=false}=action.payload;state.messages=[...state.messages,{text,send,createdAt:String(new Date())}];},deleteChat:(state,action)=>{state.chats=state.chats.filter(chat=>chat._id!==action.payload);if(action.payload===state.conversationID)state.conversationID=\"\";}},extraReducers:{[getAllChats.fulfilled]:(state,action)=>{const{users,chats}=action.payload;const getUserDetails=members=>users.find(user=>members.includes(user._id));state.chats=chats.map(chat=>({...chat,userDetails:getUserDetails(chat.members)}));},[updateChats.fulfilled]:(state,action)=>{var _action$payload2;const updatingChat=state.chats[(_action$payload2=action.payload)===null||_action$payload2===void 0?void 0:_action$payload2.index];if(updatingChat){state.chats=[{...updatingChat,lastMessage:action.payload.lastMessage},...state.chats.filter(chat=>chat._id!==updatingChat._id)];}},[logout.type]:(state,action)=>{return initialState;}}});export const{addMessages,clearMessage,setChatID,setReceiverID,setMessages,deleteChat}=messageSlice.actions;export default messageSlice.reducer;","map":{"version":3,"names":["createAsyncThunk","createSlice","createChatService","fetchChatsService","fetchMessagesService","logout","initialState","conversationID","to","messages","chats","getAllChats","props","thunkAPI","customFetch","users","getState","rejectWithValue","fulfillWithValue","user","data","filter","u","_id","id","createChat","dispatch","message","partnerId","every","chat","cid","messageSlice","actions","setChatID","setReceiverID","_data","chatId","clearMessage","setMessages","updateChats","lastMessage","index","findIndex","members","includes","name","reducers","state","action","_action$payload","payload","updatingChat","map","text","send","sender","createdAt","addMessages","String","Date","deleteChat","extraReducers","fulfilled","getUserDetails","find","userDetails","_action$payload2","type","reducer"],"sources":["C:/Users/samth/repomain-1/src/features/messageSlice.js"],"sourcesContent":["import { createAsyncThunk, createSlice } from \"@reduxjs/toolkit\";\r\nimport { createChatService, fetchChatsService, fetchMessagesService } from \"../services/messageServices\";\r\nimport { logout } from \"./userSlice\";\r\n\r\nconst initialState = {\r\n\tconversationID: \"\",\r\n\tto: \"\",\r\n\tmessages: [],\r\n\tchats: [],\r\n};\r\n\r\nexport const getAllChats = createAsyncThunk(\"message/getAllChats\", async (props, thunkAPI) => {\r\n\tconst { customFetch, users } = props;\r\n\tconst { getState, rejectWithValue, fulfillWithValue } = thunkAPI;\r\n\tconst { user } = getState();\r\n\tconst data = await customFetch(fetchChatsService);\r\n\tif (!data) return rejectWithValue();\r\n\treturn fulfillWithValue({\r\n\t\tusers: users.filter(u => u._id !== user.id),\r\n\t\tchats: data.chats,\r\n\t});\r\n});\r\n\r\nexport const createChat = createAsyncThunk(\"message/createChat\", async (props, thunkAPI) => {\r\n\tconst { getState, dispatch, rejectWithValue } = thunkAPI;\r\n\tconst { customFetch, id } = props;\r\n\tconst { user, users, message } = getState();\r\n\tconst data = await customFetch(createChatService, { partnerId: id });\r\n\tif (!data) rejectWithValue();\r\n\tif (message.chats.every(chat => chat._id !== data.cid)) {\r\n\t\tdispatch(getAllChats({ customFetch, users: users.users }));\r\n\t}\r\n\tdispatch(messageSlice.actions.setChatID(data.cid));\r\n\tdispatch(messageSlice.actions.setReceiverID(id));\r\n\tconst _data = await customFetch(fetchMessagesService, { chatId: data.cid });\r\n\tdispatch(clearMessage());\r\n\tdispatch(setMessages({ messages: _data.messages, id: user.id }));\r\n});\r\n\r\nexport const updateChats = createAsyncThunk(\"message/updateChat\", async (props, thunkAPI) => {\r\n\tconst { getState, dispatch, fulfillWithValue } = thunkAPI;\r\n\tconst { lastMessage, id, chatId, customFetch } = props;\r\n\tconst { message, users } = getState();\r\n\tlet index;\r\n\tif (chatId) index = message.chats.findIndex(chat => chat._id === chatId);\r\n\telse index = message.chats.findIndex(chat => chat.members.includes(id));\r\n\tif (index >= 0) return fulfillWithValue({ index, lastMessage });\r\n\tdispatch(getAllChats({ customFetch, users: users.users }));\r\n});\r\n\r\nconst messageSlice = createSlice({\r\n\tname: \"message\",\r\n\tinitialState,\r\n\treducers: {\r\n\t\tclearMessage: (state, action) => {\r\n\t\t\tconst conversationID = action.payload?.conversationID;\r\n\t\t\tif (conversationID) {\r\n\t\t\t\tconst index = state.chats.findIndex(chat => chat._id === conversationID);\r\n\t\t\t\tconst updatingChat = state.chats[index];\r\n\t\t\t\tstate.chats = [\r\n\t\t\t\t\t{ ...updatingChat, lastMessage: \"\" },\r\n\t\t\t\t\t...state.chats.filter(chat => chat._id !== conversationID),\r\n\t\t\t\t];\r\n\t\t\t\tif (conversationID === state.conversationID) state.messages = [];\r\n\t\t\t} else {\r\n\t\t\t\tstate.messages = [];\r\n\t\t\t}\r\n\t\t},\r\n\t\tsetChatID: (state, action) => {\r\n\t\t\tstate.conversationID = action.payload;\r\n\t\t},\r\n\t\tsetReceiverID: (state, action) => {\r\n\t\t\tstate.to = action.payload;\r\n\t\t},\r\n\t\tsetMessages: (state, action) => {\r\n\t\t\tconst { messages, id } = action.payload;\r\n\t\t\tstate.messages = messages.map(message => {\r\n\t\t\t\treturn { text: message.text, send: message.sender === id, createdAt: message.createdAt };\r\n\t\t\t});\r\n\t\t},\r\n\t\taddMessages: (state, action) => {\r\n\t\t\tconst { text, send = false } = action.payload;\r\n\t\t\tstate.messages = [...state.messages, { text, send, createdAt: String(new Date()) }];\r\n\t\t},\r\n\t\tdeleteChat: (state, action) => {\r\n\t\t\tstate.chats = state.chats.filter(chat => chat._id !== action.payload);\r\n\t\t\tif (action.payload === state.conversationID) state.conversationID = \"\";\r\n\t\t},\r\n\t},\r\n\textraReducers: {\r\n\t\t[getAllChats.fulfilled]: (state, action) => {\r\n\t\t\tconst { users, chats } = action.payload;\r\n\t\t\tconst getUserDetails = members => users.find(user => members.includes(user._id));\r\n\t\t\tstate.chats = chats.map(chat => ({ ...chat, userDetails: getUserDetails(chat.members) }));\r\n\t\t},\r\n\t\t[updateChats.fulfilled]: (state, action) => {\r\n\t\t\tconst updatingChat = state.chats[action.payload?.index];\r\n\t\t\tif (updatingChat) {\r\n\t\t\t\tstate.chats = [\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t...updatingChat,\r\n\t\t\t\t\t\tlastMessage: action.payload.lastMessage,\r\n\t\t\t\t\t},\r\n\t\t\t\t\t...state.chats.filter(chat => chat._id !== updatingChat._id),\r\n\t\t\t\t];\r\n\t\t\t}\r\n\t\t},\r\n\t\t[logout.type]: (state, action) => {\r\n\t\t\treturn initialState;\r\n\t\t},\r\n\t},\r\n});\r\n\r\nexport const { addMessages, clearMessage, setChatID, setReceiverID, setMessages, deleteChat } =\r\n\tmessageSlice.actions;\r\n\r\nexport default messageSlice.reducer;\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}